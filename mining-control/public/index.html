<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KLOUD Mining Control Center</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #00ff88;
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #00ff88;
            border-radius: 10px;
            background: rgba(0, 255, 136, 0.1);
        }

        .header h1 {
            font-size: 2.5em;
            color: #ffd700;
            text-shadow: 0 0 20px #ffd700;
            margin-bottom: 10px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .rig-card {
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 20px;
            background: rgba(0, 255, 136, 0.05);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .rig-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
        }

        .rig-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .rig-name {
            font-size: 1.2em;
            color: #ffd700;
            font-weight: bold;
        }

        .status-online {
            color: #00ff88;
            font-weight: bold;
        }

        .status-offline {
            color: #ff4444;
            font-weight: bold;
        }

        .status-restarting {
            color: #ffaa00;
            font-weight: bold;
        }

        .metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .metric {
            text-align: center;
            padding: 10px;
            border: 1px solid #00ff88;
            border-radius: 8px;
            background: rgba(0, 255, 136, 0.1);
        }

        .metric-value {
            font-size: 1.5em;
            color: #00ddff;
            font-weight: bold;
        }

        .metric-label {
            font-size: 0.8em;
            color: #888;
            margin-top: 5px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #00ff88;
            border-radius: 8px;
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .btn:hover {
            background: rgba(0, 255, 136, 0.3);
            transform: scale(1.05);
        }

        .btn.danger {
            border-color: #ff4444;
            color: #ff4444;
        }

        .btn.danger:hover {
            background: rgba(255, 68, 68, 0.3);
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
        }

        .connected {
            background: rgba(0, 255, 136, 0.2);
            border: 2px solid #00ff88;
            color: #00ff88;
        }

        .disconnected {
            background: rgba(255, 68, 68, 0.2);
            border: 2px solid #ff4444;
            color: #ff4444;
        }

        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .summary-card {
            text-align: center;
            padding: 20px;
            border: 2px solid #ffd700;
            border-radius: 15px;
            background: rgba(255, 215, 0, 0.1);
        }

        .summary-value {
            font-size: 2em;
            color: #ffd700;
            font-weight: bold;
        }

        .summary-label {
            color: #888;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">
        üîå Connecting...
    </div>

    <div class="header">
        <h1>‚õèÔ∏è KLOUD MINING CONTROL</h1>
        <p>Real-time Mining Operations Dashboard</p>
    </div>

    <div class="status-grid" id="rigsGrid">
        <!-- Mining rigs will be populated here -->
    </div>

    <div class="summary">
        <div class="summary-card">
            <div class="summary-value" id="totalHashrate">0</div>
            <div class="summary-label">Total Hashrate</div>
        </div>
        <div class="summary-card">
            <div class="summary-value" id="totalPower">0W</div>
            <div class="summary-label">Total Power Draw</div>
        </div>
        <div class="summary-card">
            <div class="summary-value" id="totalRevenue">$0</div>
            <div class="summary-label">Daily Revenue</div>
        </div>
        <div class="summary-card">
            <div class="summary-value" id="onlineRigs">0/0</div>
            <div class="summary-label">Online Rigs</div>
        </div>
    </div>

    <script>
        let ws;
        let rigs = [];

        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/mining-ws`;
            
            ws = new WebSocket(wsUrl);

            ws.onopen = () => {
                console.log('Connected to mining control');
                updateConnectionStatus(true);
            };

            ws.onmessage = (event) => {
                const message = JSON.parse(event.data);
                if (message.type === 'rigs:update') {
                    rigs = message.data;
                    updateDisplay();
                }
            };

            ws.onclose = () => {
                console.log('Disconnected from mining control');
                updateConnectionStatus(false);
                // Reconnect after 3 seconds
                setTimeout(connectWebSocket, 3000);
            };

            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
                updateConnectionStatus(false);
            };
        }

        function updateConnectionStatus(connected) {
            const status = document.getElementById('connectionStatus');
            if (connected) {
                status.className = 'connection-status connected';
                status.textContent = 'üü¢ Connected';
            } else {
                status.className = 'connection-status disconnected';
                status.textContent = 'üî¥ Disconnected';
            }
        }

        function sendCommand(rigId, command) {
            fetch(`/api/rigs/${rigId}/command`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ command })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log(data.message);
                } else {
                    console.error(data.error);
                }
            })
            .catch(error => {
                console.error('Command failed:', error);
            });
        }

        function updateDisplay() {
            const grid = document.getElementById('rigsGrid');
            grid.innerHTML = '';

            let totalHashrateBTC = 0;
            let totalHashrateETH = 0;
            let totalPower = 0;
            let totalRevenue = 0;
            let onlineCount = 0;

            rigs.forEach(rig => {
                if (rig.status === 'online') {
                    onlineCount++;
                    if (rig.type === 'bitcoin') {
                        totalHashrateBTC += rig.hashrate;
                    } else {
                        totalHashrateETH += rig.hashrate;
                    }
                    totalPower += rig.powerDraw;
                    totalRevenue += rig.dailyRevenue;
                }

                const card = document.createElement('div');
                card.className = 'rig-card';
                card.innerHTML = `
                    <div class="rig-header">
                        <div class="rig-name">${rig.name}</div>
                        <div class="status-${rig.status}">${rig.status.toUpperCase()}</div>
                    </div>
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-value">${rig.hashrate.toFixed(1)}</div>
                            <div class="metric-label">${rig.type === 'bitcoin' ? 'TH/s' : 'GH/s'}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${rig.temperature.toFixed(1)}¬∞C</div>
                            <div class="metric-label">Temperature</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${rig.powerDraw}W</div>
                            <div class="metric-label">Power Draw</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">$${rig.dailyRevenue}</div>
                            <div class="metric-label">Daily Revenue</div>
                        </div>
                    </div>
                    <div class="controls">
                        <button class="btn" onclick="sendCommand('${rig.id}', 'restart')">Restart</button>
                        <button class="btn" onclick="sendCommand('${rig.id}', 'start')">Start</button>
                        <button class="btn danger" onclick="sendCommand('${rig.id}', 'shutdown')">Shutdown</button>
                    </div>
                `;
                grid.appendChild(card);
            });

            // Update summary
            document.getElementById('totalHashrate').textContent = 
                `${totalHashrateBTC.toFixed(1)} TH/s + ${totalHashrateETH.toFixed(1)} GH/s`;
            document.getElementById('totalPower').textContent = `${totalPower}W`;
            document.getElementById('totalRevenue').textContent = `$${totalRevenue.toFixed(2)}`;
            document.getElementById('onlineRigs').textContent = `${onlineCount}/${rigs.length}`;
        }

        // Connect when page loads
        connectWebSocket();
    </script>
</body>
</html>